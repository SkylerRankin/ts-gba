<!DOCTYPE html>
<html>
    <head>
        <title>ts-gba</title>
        <script src="./tsgba.js"></script>
        <style>
            * {
                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                -webkit-user-select: none;
                -ms-user-select: none;
                user-select: none;
            }

            #container { width: 1000px; margin: 50px auto; }
            #canvas_container canvas { position: absolute; image-rendering: pixelated; background-color: #e1e1e1; }
            #game_control_container { margin-bottom: 10px; }
            #game_control_container > div { margin-right: 20px; }
            #key_container > div { margin-bottom: 10px; }
            #key_container > table { width: 100%; border-collapse: collapse; }
            #title_link { color: #0398fc; text-decoration: none; font-size: 20px; font-weight: bold; }
            #tab_container { width: 480px; display: inline-block; min-height: 320px; font-size: 12px; }
            #tab_row { margin-bottom: 30px; display: flex; font-size: 16px; }
            #step_button_container { margin-bottom: 10px; display: flex; justify-content: space-between; }
            #step_button_container > div { flex-grow: 1; }
            #step_button_container > div + div { margin-left: 20px; }
            #instruction_table { width: 100%; }
            #instruction_table, #instruction_table > tr, #instruction_table > tr > td { border-collapse: collapse; }
            #registers_table_container, #instruction_table_container, #key_container, #fps_container {
                padding: 5px;
                border: solid 1px #969696;
                border-radius: 3px;
                margin-bottom: 10px;
            }
            #registers_table { width: 100%; }
            #registers_table, #registers_table > tr, #registers_table > tr > td { border-collapse: collapse; }
            #instruction_jump_container { display: flex; margin-bottom: 10px; }
            #instruction_jump_container > div { flex-grow: 1; margin-left: 20px; text-align: center; }
            #instruction_jump_container > input { border: solid 1px #969696; border-radius: 3px; }
            #fps_container td { padding-right: 20px; }
            #palette_canvas { margin: auto; display: block; }
            #charblock_canvas { margin: auto; display: block; }
            #interrupt_table { width: 100%; }
            #interrupt_table > tbody > tr > td:nth-child(odd) { width: 20%; }

            .hidden { display: none; }
            .tab {
                border-bottom: solid 1px #969696;
                width: 100px;
                color: #969696;
                cursor: pointer;
                text-align: left;
                padding-left: 5px;
                width: 80px;
                margin-right: 20px;
            }
            .tab_selected { color: #000; font-weight: bold; }
            .button {
                display: inline-block;
                border: solid 1px #969696;
                border-radius: 3px;
                text-align: center;
                line-height: 20px;
                cursor: pointer;
                width: 80px;
                height: 20px;
                font-size: 12px;
            }
            .button:hover { background-color: #cccccc; }
            .instruction_table_pc_row { background-color: #5996f7; }
            .instruction_table_breakpoint_row { font-weight: bold; color: #942b2b; }
            .cpsr_flag { color: #e1e1e1; }
            .cpsr_flag_active { color: black; font-weight: bold; }
            .outline_container {
                padding: 5px;
                border: solid 1px #969696;
                border-radius: 3px;
                margin-bottom: 10px;
            }
            .number_selector {
                width: 69px;
                display: flex;
            }
            .number_selector div {
                width: 20px;
                text-align: center;
            }
            .number_selector > :first-child:hover, .number_selector > :last-child:hover {
                cursor: pointer;
                background-color: #e8e8e8;
            }
            .number_selector > :first-child {
                border: solid 1px #969696;
                border-radius: 3px 0px 0px 3px;
            }
            .number_selector > :nth-child(2) {
                border-top: solid 1px #969696;
                border-bottom: solid 1px #969696;
                width: 40px !important;
            }
            .number_selector > :last-child {
                border: solid 1px #969696;
                border-radius: 0px 3px 3px 0px;
            }
            .dropdown {
                background-color: white;
                border: solid 1px #969696;
                border-radius: 3px;
                font-size: 12px;
            }
            .page_selector {
                width: 50px;
                display: flex;
            }
            .page_selector div {
                flex-grow: 1;
            }
            .page_selector div:hover {
                cursor: pointer;
                background-color: #e8e8e8;
            }
            .page_selector > :first-child {
                border: solid 1px #969696;
                border-radius: 3px 0px 0px 3px;
            }
            .page_selector > :last-child {
                border: solid 1px #969696;
                border-radius: 0px 3px 3px 0px;
            }
            .interrupt_disabled {
                color: #e8e8e8;
                font-weight: normal;
            }
            .interrupt_enabled {
                color: black;
                font-weight: bold;
            }


        </style>

        <script>
            let gba = null;
            let romLoaded = false;
            let running = false;
            let fpsTimer = null;

            let instructionTableState = {
                pcOffset: 0,
                checkScroll: true,
                activeAddress: 0,
                lastClickedRowAddress: 0,
                lastClickedRowTime: 0,
                doubleClickMs: 400,
            };

            const tileState = {
                charblock: 1,
                paletteMode16: true,
                paletteIndex: 0,
                tilePage: 0,
                tilesPerPage: 12 * 8
            };

            const paletteState = {
                showBackgroundPalette: true
            };

            const keyCodeToKey = {
                219: "A",
                221: "B",
                13: "Select",
                16: "Start",
                68: "Right",
                39: "Right",
                65: "Left",
                37: "Left",
                87: "Up",
                38: "Up",
                83: "Down",
                40: "Down",
                76: "L",
                82: "R"
            };

            const onTabSelect = (tabIndex) => {
                for (let i = 0; i < 3; i++) {
                    const tab = document.getElementById(`tab${i}`);
                    const tabContainer = document.getElementById(`tab${i}_container`);
                    if (i === tabIndex) {
                        tab.classList.add('tab_selected');
                        tabContainer.classList.remove('hidden');

                    } else {
                        tab.classList.remove('tab_selected');
                        tabContainer.classList.add('hidden');
                    }
                }
            }

            const onROMUpload = (event) => {
                if (!event.files || !event.files[0]) {
                    console.error(`No ROM file uploaded.`);
                    return;
                }
                const fileReader = new FileReader();
                fileReader.onloadend = event => {
                    if (fileReader.result !== null) {
                        const buffer = new Uint8Array(fileReader.result);
                        gba.reset();
                        gba.loadROM(buffer);
                        romLoaded = true;
                        onPause();
                    }
                };
                fileReader.readAsArrayBuffer(event.files[0]);
            }

            const onBIOSUpload = (event) => {
                if (!event.files || !event.files[0]) {
                    console.error(`No BIOS file uploaded.`);
                    return;
                }
                const fileReader = new FileReader();
                fileReader.onloadend = event => {
                    if (fileReader.result !== null) {
                        const buffer = new Uint8Array(fileReader.result);
                        gba.loadBIOS(buffer);
                    }
                };
                fileReader.readAsArrayBuffer(event.files[0]);
            }

            const onRun = () => {
                instructionTableState.pcOffset = 0;
                document.getElementById("cpu_info_warning").classList.remove("hidden");
                document.getElementById("cpu_info_container").classList.add("hidden");
                document.getElementById("ppu_info_warning").classList.remove("hidden");
                document.getElementById("ppu_info_container").classList.add("hidden");
                romLoaded = true;
                gba.run();
                fpsTimer = setTimeout(() => { onFPSUpdate(); }, 250);
            }

            const onPause = () => {
                gba.pause();
                document.getElementById("cpu_info_warning").classList.add("hidden");
                document.getElementById("cpu_info_container").classList.remove("hidden");
                document.getElementById("ppu_info_warning").classList.add("hidden");
                document.getElementById("ppu_info_container").classList.remove("hidden");

                // Focus instruction list on PC on pause
                instructionTableState.activeAddress = gba.cpu.getGeneralRegister(15) - gba.cpu.instructionSize * 2;
                updateInstructionList();
                updateRegisters();
                updateColorPalettes();
                updateTiles();
                updateDisplayControl();
                updateInterrupts();
                clearTimeout(fpsTimer);
            }

            const onReset = () => {
                gba.reset();
                document.getElementById("cpu_info_warning").classList.add("hidden");
                document.getElementById("cpu_info_container").classList.remove("hidden");
                document.getElementById("ppu_info_warning").classList.add("hidden");
                document.getElementById("ppu_info_container").classList.remove("hidden");
                romLoaded = false;
                clearTimeout(fpsTimer);
            }

            const onStep = () => {
                gba.runStep();
                instructionTableState.activeAddress = gba.cpu.getGeneralRegister(15) - gba.cpu.instructionSize * 2;
                instructionTableState.pcOffset = 0;
                updateInstructionList();
                updateRegisters();
                updateColorPalettes();
                updateTiles();
                updateDisplayControl();
                updateInterrupts();
            }

            const onSelectRow = () => {
                const address = instructionTableState.lastClickedRowAddress;
                if (gba.cpu.breakpoints.has(address)) {
                    gba.cpu.removeBreakpoint(address);
                } else {
                    gba.cpu.setBreakpoint(address);
                }
                updateInstructionList();
            }

            const updateRegisters = () => {
                const text = window.UI.getRegisterText(gba);

                Object.entries(text).forEach(([key, text]) => {
                    if (key.startsWith("r")) {
                        document.getElementById(`${key}_value`).innerHTML = text;
                    } else if (key === "cpsr") {
                        document.getElementById("cpsr_value").innerHTML = text;
                    } else if (key === "spsr") {
                        document.getElementById("spsr_value").innerHTML = text;
                    } else if (key.startsWith("flag_")) {
                        if (text === "true") {
                            document.getElementById(key).classList.add("cpsr_flag_active");
                        } else {
                            document.getElementById(key).classList.remove("cpsr_flag_active");
                        }
                    }
                });
            }

            const updateInstructionList = () => {
                const pc = gba.cpu.getGeneralRegister(15) - gba.cpu.instructionSize * 2;
                const lines = window.UI.getInstructionTableLines(instructionTableState.activeAddress + instructionTableState.pcOffset * gba.cpu.instructionSize, 11, gba);

                const table = document.getElementById("instruction_table");
                table.replaceChildren([]);
                lines.forEach(line => {
                    const tr = document.createElement("tr");
                    if (line.address === pc) {
                        tr.classList.add("instruction_table_pc_row");
                    }

                    if (gba.cpu.breakpoints.has(line.address)) {
                        tr.classList.add("instruction_table_breakpoint_row");
                    }

                    tr.addEventListener("click", () => {
                        if (instructionTableState.lastClickedRowAddress === line.address) {
                            if (performance.now() - instructionTableState.lastClickedRowTime < instructionTableState.doubleClickMs) {
                                onSelectRow();
                            }
                        } else {
                            instructionTableState.lastClickedRowAddress = line.address;
                        }
                        instructionTableState.lastClickedRowTime = performance.now();
                    });

                    const address = document.createElement("td");
                    address.innerHTML = `0x${line.address.toString(16).padStart(8, '0')}`;
                    address.style = "width: 20%;";

                    const instruction = document.createElement("td");
                    instruction.innerHTML = `0x${line.instruction.toString(16).padStart(gba.cpu.operatingState === "ARM" ? 8 : 4, '0')}`;
                    instruction.style = "width: 20%;";

                    const text = document.createElement("td");
                    text.innerHTML = line.text.toLowerCase();
                    text.style = "width: 50%;";

                    tr.appendChild(address);
                    tr.appendChild(instruction);
                    tr.appendChild(text);
                    table.appendChild(tr);
                });
            }

            const updateDisplayControl = () => {
                const {
                    displayMode,
                    frameSelect,
                    hblankIntervalFree,
                    objVRAMMapping,
                    forcedBlank,
                    enabledBackgrounds,
                    displayObj
                } = window.UI.getDisplayControl(gba);

                document.getElementById("display_mode_text").innerHTML = displayMode;
                document.getElementById("frame_select_text").innerHTML = frameSelect;
                document.getElementById("hblank_interval_text").innerHTML = hblankIntervalFree;
                document.getElementById("obj_vram_mapping_text").innerHTML = objVRAMMapping;
                document.getElementById("forced_blank_text").innerHTML = forcedBlank;
                document.getElementById("enabled_backgrounds_text").innerHTML = enabledBackgrounds;
                document.getElementById("display_obj_text").innerHTML = displayObj;
            }

            const updateColorPalettes = () => {
                const spacing = 4;
                const tileWidth = 20;
                const tileHeight = 10;
                const { bgPalette, spritePalette } = window.UI.getPaletteColors(gba);
                const context = document.getElementById("palette_canvas").getContext("2d");
                if (paletteState.showBackgroundPalette) {
                    bgPalette.forEach((color, i) => {
                        const x = i % 16;
                        const y = Math.floor(i / 16);
                        context.fillStyle = color;
                        context.fillRect(x * (tileWidth + spacing), y * (tileHeight + spacing), tileWidth, tileHeight);
                    });
                } else {
                    spritePalette.forEach((color, i) => {
                        const x = i % 16;
                        const y = Math.floor(i / 16);
                        context.fillStyle = color;
                        context.fillRect(x * (tileWidth + spacing), y * (tileHeight + spacing), tileWidth, tileHeight);
                    });
                }
            }

            const updateTiles = () => {
                const canvas = document.getElementById(`charblock_canvas`);
                const context = canvas.getContext("2d");

                const tiles = window.UI.getTiles(gba, tileState.charblock - 1, tileState.paletteMode16, tileState.paletteIndex);

                const tileSpacing = 2;
                const tilePixelSize = 32;
                const totalWidth = canvas.width;
                const maxTiles = tileState.paletteMode16 ? 512 : 256;
                const startTile = tileState.tilePage * tileState.tilesPerPage;

                document.getElementById("charblock_value").innerHTML = tileState.charblock;
                document.getElementById("palette_index_value").innerHTML = tileState.paletteIndex;
                document.getElementById("tile_range_text").innerHTML = `Tiles ${tileState.tilePage * tileState.tilesPerPage} - ${Math.min((tileState.tilePage + 1) * tileState.tilesPerPage - 1, maxTiles - 1)}`;

                let currentX = 0;
                let currentY = 0;

                for (let i = startTile; i < startTile + tileState.tilesPerPage && i < tiles.length; i++) {
                    const tile = tiles[i];
                    for (let x = 0; x < 8; x++) {
                        for (let y = 0; y < 8; y++) {
                            const color = tile[y * 8 + x];
                            context.fillStyle = `rgb(${color.red}, ${color.green}, ${color.blue})`;
                            context.fillRect(currentX + x * 4, currentY + y * 4, 4, 4);
                        }
                    }

                    currentX += tilePixelSize + tileSpacing;
                    if (currentX + tilePixelSize > totalWidth) {
                        currentX = 0;
                        currentY += tilePixelSize + tileSpacing;
                    }
                }
            }

            const updateInterrupts = () => {
                const interrupts = window.UI.getInterruptInfo(gba);
                Object.entries(interrupts.values).forEach(([k, value]) => {
                    document.getElementById(`interrupt_${k}`).innerHTML = value;
                });
                Object.entries(interrupts.flags).forEach(([k, enabled]) => {
                    const element = document.getElementById(`interrupt_${k}`);
                    if (enabled) {
                        element.innerHTML = "Enabled";
                        element.classList.remove("interrupt_disabled");
                        element.classList.add("interrupt_enabled");
                    } else {
                        element.innerHTML = "Disabled";
                        element.classList.add("interrupt_disabled");
                        element.classList.remove("interrupt_enabled");
                    }
                });
            }

            const setPPUListeners = () => {
                document.getElementById("charblock_decrease").onclick = () => {
                    tileState.charblock = Math.max(1, tileState.charblock - 1);
                    updateTiles();
                };
                document.getElementById("charblock_increase").onclick = () => {
                    tileState.charblock = Math.min(6, tileState.charblock + 1);
                    updateTiles();
                };
                document.getElementById("palette_mode_dropdown").onchange = (event) => {
                    tileState.paletteMode16 = event.target.value === "16";
                    updateTiles();
                };
                document.getElementById("palette_index_decrease").onclick = () => {
                    tileState.paletteIndex = Math.max(0, tileState.paletteIndex - 1);
                    updateTiles();
                };
                document.getElementById("palette_index_increase").onclick = () => {
                    tileState.paletteIndex = Math.min(15, tileState.paletteIndex + 1);
                    updateTiles();
                };
                document.getElementById("tile_page_decrease").onclick = () => {
                    tileState.tilePage = Math.max(0, tileState.tilePage - 1);
                    updateTiles();
                };
                document.getElementById("tile_page_increase").onclick = () => {
                    const maxTiles = tileState.paletteMode16 ? 512 : 256;
                    const maxPage = Math.floor(maxTiles / tileState.tilesPerPage);
                    tileState.tilePage = Math.min(maxPage, tileState.tilePage + 1);
                    updateTiles();
                };
                document.getElementById("palette_dropdown").onchange = (event) => {
                    paletteState.showBackgroundPalette = event.target.value === "background";
                    updateColorPalettes();
                };
            }

            const onKeyUpdate = (key, pressed) => {
                const gbaKey = keyCodeToKey[key];
                if (gbaKey) {
                    if (pressed) gba.keypad.onKeyDown(gbaKey);
                    else gba.keypad.onKeyUp(gbaKey);
                }
            }

            const onFPSUpdate = () => {
                const { fps, frameTime, cycles, steps } = window.UI.getFrameInfo(gba);
                document.getElementById("fps_value").innerHTML = fps.toFixed(2);
                document.getElementById("frame_time_value").innerHTML = frameTime.toFixed(2);
                document.getElementById("cycles_value").innerHTML = Math.floor(cycles);
                document.getElementById("steps_value").innerHTML = Math.floor(steps);
                fpsTimer = setTimeout(() => { onFPSUpdate(); }, 250);
            }

            window.onload = () => {
                gba = new window.GBA();
                gba.reset();

                document.getElementById("startButton").onclick = () => {
                    if (romLoaded) {
                        onRun();
                    } else {
                        console.warn("No rom loaded");
                    }
                };
                document.getElementById("resetButton").onclick = () => { onReset(); };
                document.getElementById("instruction_table").addEventListener("wheel", (event) => {
                    if (!instructionTableState.checkScroll) return;
                    instructionTableState.pcOffset += Math.sign(event.wheelDeltaY) * -1;
                    requestAnimationFrame(() => {
                        updateInstructionList();
                        instructionTableState.checkScroll = true;
                    });
                    instructionTableState.checkScroll = false;
                });

                document.getElementById("debug_reset_button").addEventListener("click", () => { onReset(); });
                document.getElementById("debug_run_button").addEventListener("click", () => { onRun(); });
                document.getElementById("debug_pause_button").addEventListener("click", () => { onPause(); });
                document.getElementById("debug_step_button").addEventListener("click", () => { onStep(); });
                document.getElementById("instruction_jump_button").addEventListener("click", () => {
                    let addressText = document.getElementById("instruction_jump_input").value;
                    if (!addressText.startsWith("0x")) addressText = "0x" + addressText;
                    const address = Number.parseInt(addressText);
                    const instructionSize = gba.cpu.operatingState === "ARM" ? 4 : 2;
                    instructionTableState.pcOffset = (address - instructionTableState.activeAddress) / instructionSize;
                    updateInstructionList();
                });
                document.getElementById("instruction_pc_button").addEventListener("click", () => {
                    instructionTableState.pcOffset = 0;
                    updateInstructionList();
                });

                setPPUListeners();

                gba.cpu.breakpointCallback = () => {
                    onPause();
                }

                document.addEventListener("keydown", (event) => { onKeyUpdate(event.keyCode, true); });
                document.addEventListener("keyup", (event) => { onKeyUpdate(event.keyCode, false); });

            }
        </script>
    </head>
    <body>
        <div id="container">
            <div style="margin-bottom: 20px;">
                <a href="https://github.com/SkylerRankin/ts-gba" id="title_link">ts-gba</a>
            </div>
            <div style="display: flex; justify-content: space-between;">
                <div id="canvas_container">
                    <canvas id="frame_0_canvas" width="480px" height="320px" tabindex="0"></canvas>
                    <canvas id="frame_1_canvas" width="480px" height="320px" tabindex="0" class="hidden"></canvas>
                </div>
                <div id="tab_container">
                    <div id="tab_row">
                        <div id="tab0" class="tab tab_selected" onclick="onTabSelect(0)">Game</div>
                        <div id="tab1" class="tab" onclick="onTabSelect(1)">CPU</div>
                        <div id="tab2" class="tab" onclick="onTabSelect(2)">PPU</div>
                    </div>
                    <div id="tab0_container" class="">
                        <div id="game_control_container">
                            <input id="romInput" type="file" style="display: none !important;" onChange="onROMUpload(this)">
                            <input id="biosInput" type="file" style="display: none !important;" onChange="onBIOSUpload(this)">
                            <div class="button" id='uploadButton' onClick="document.getElementById('romInput').click()"}>Upload ROM</div>
                            <div class="button" id='uploadBiosButton' onClick="document.getElementById('biosInput').click()"}>Upload BIOS</div>
                            <div class="button" id="startButton">Start</div>
                            <div class="button" id="resetButton">Reset</div>
                        </div>
                        <div id="key_container">
                            <div>Controls</div>
                            <table>
                                <tr>
                                    <td>A Button</td>
                                    <td>[</td>
                                    <td>Right Button</td>
                                    <td>D / Right</td>
                                    <td>L Button</td>
                                    <td>L</td>
                                </tr>
                                <tr>
                                    <td>B Button</td>
                                    <td>]</td>
                                    <td>Left Button</td>
                                    <td>A / Left</td>
                                    <td>R Button</td>
                                    <td>R</td>
                                </tr>
                                <tr>
                                    <td>Select</td>
                                    <td>Enter</td>
                                    <td>Up Button</td>
                                    <td>W / Up</td>
                                </tr>
                                <tr>
                                    <td>Start</td>
                                    <td>Shift</td>
                                    <td>Down Button</td>
                                    <td>S / Down</td>
                                </tr>
                            </table>
                        </div>
                        <div id="fps_container">
                            <table>
                                <tr>
                                    <td>Mean frames per second</td>
                                    <td id="fps_value">0</td>
                                </tr>
                                <tr>
                                    <td>Mean frame time (ms)</td>
                                    <td id="frame_time_value">0</td>
                                </tr>
                                <tr>
                                    <td>Elapsed cycles per frame</td>
                                    <td id="cycles_value">0</td>
                                </tr>
                                <tr>
                                    <td>Elapsed steps per frame</td>
                                    <td id="steps_value">0</td>
                                </tr>
                            </table>
                        </div>
                    </div>
                    <div id="tab1_container" class="hidden">
                        <div id="step_button_container">
                            <div class="button" id="debug_reset_button">Reset</div>
                            <div class="button" id="debug_run_button">Run</div>
                            <div class="button" id="debug_pause_button">Pause</div>
                            <div class="button" id="debug_step_button">Step</div>
                        </div>
                        <div id="cpu_info_container" class="hidden">
                            <div id="registers_table_container">
                                <table id="registers_table">
                                    <tr>
                                        <td>R0</td>
                                        <td id="r0_value">00000000</td>
                                        <td>R8</td>
                                        <td id="r8_value">00000000</td>
                                        <td>CPSR</td>
                                        <td id="cpsr_value">00000000</td>
                                    </tr>
                                    <tr>
                                        <td>R1</td>
                                        <td id="r1_value">00000000</td>
                                        <td>R9</td>
                                        <td id="r9_value">00000000</td>
                                        <td>SPSR</td>
                                        <td id="spsr_value">00000000</td>
                                    </tr>
                                    <tr>
                                        <td>R2</td>
                                        <td id="r2_value">00000000</td>
                                        <td>R10</td>
                                        <td id="r10_value">00000000</td>
                                        <td>Flags</td>
                                        <td>
                                            <span id="flag_n" class="cpsr_flag">n</span>
                                            <span id="flag_z" class="cpsr_flag">z</span>
                                            <span id="flag_c" class="cpsr_flag">c</span>
                                            <span id="flag_v" class="cpsr_flag">v</span>
                                            <span id="flag_i" class="cpsr_flag">i</span>
                                            <span id="flag_f" class="cpsr_flag">f</span>
                                            <span id="flag_t" class="cpsr_flag">t</span>
                                            <span id="flag_q" class="cpsr_flag">q</span>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>R3</td>
                                        <td id="r3_value">00000000</td>
                                        <td>R11</td>
                                        <td id="r11_value">00000000</td>
                                    </tr>
                                    <tr>
                                        <td>R4</td>
                                        <td id="r4_value">00000000</td>
                                        <td>R12</td>
                                        <td id="r12_value">00000000</td>
                                    </tr>
                                    <tr>
                                        <td>R5</td>
                                        <td id="r5_value">00000000</td>
                                        <td>R13</td>
                                        <td id="r13_value">00000000</td>
                                    </tr>
                                    <tr>
                                        <td>R6</td>
                                        <td id="r6_value">00000000</td>
                                        <td>R14</td>
                                        <td id="r14_value">00000000</td>
                                    </tr>
                                    <tr>
                                        <td>R7</td>
                                        <td id="r7_value">00000000</td>
                                        <td>R15</td>
                                        <td id="r15_value">00000000</td>
                                    </tr>
                                </table>
                            </div>
                            <div id="instruction_table_container">
                                <table id="instruction_table"></table>
                            </div>
                            <div id="instruction_jump_container">
                                <input id="instruction_jump_input" type="text" value="08000000">
                                <div class="button" id="instruction_jump_button">Jump</div>
                                <div class="button" id="instruction_pc_button">Return to PC</div>
                            </div>
                            <div>
                                <div>Debugger notes:</div>
                                <ul style="margin-top: 0px;">
                                    <li>Double click instruction to set breakpoint, will be highlighted in red</li>
                                    <li>Current PC is highlighted in blue</li>
                                    <li>All instructions in table are decoded according to current operating state, may not be correct</li>
                                </ul>
                            </div>
                            <div class="outline_container">
                                <div style="margin-bottom: 10px;">Interrupts</div>
                                <table style="margin-bottom: 10px;">
                                    <tr>
                                        <td>IME Register</td>
                                        <td id="interrupt_imeValue">00000000</td>
                                    </tr>
                                    <tr>
                                        <td>IE Register</td>
                                        <td id="interrupt_ieValue">00000000</td>
                                    </tr>
                                    <tr>
                                        <td>IF Register</td>
                                        <td id="interrupt_ifValue">0000000</td>
                                    </tr>
                                    <tr>
                                        <td>Interrupt Check Flag</td>
                                        <td id="interrupt_checkFlag">00000000</td>
                                    </tr>
                                </table>
                                <table id="interrupt_table">
                                    <tbody>
                                        <tr>
                                            <td>CPSR I Flag</td>
                                            <td id="interrupt_cpsr"></td>
                                            <td>Timer 3</td>
                                            <td id="interrupt_timer3"></td>
                                        </tr>
                                        <tr>
                                            <td>Master</td>
                                            <td id="interrupt_ime"></td>
                                            <td>Serial</td>
                                            <td id="interrupt_serial"></td>
                                        </tr>
                                        <tr>
                                            <td>V-Blank</td>
                                            <td id="interrupt_vBlank"></td>
                                            <td>DMA 0</td>
                                            <td id="interrupt_dma0"></td>
                                        </tr>
                                        <tr>
                                            <td>H-Blank</td>
                                            <td id="interrupt_hBlank"></td>
                                            <td>DMA 1</td>
                                            <td id="interrupt_dma1"></td>
                                        </tr>
                                        <tr>
                                            <td>V-Blank Count</td>
                                            <td id="interrupt_vBlankCount"></td>
                                            <td>DMA 2</td>
                                            <td id="interrupt_dma2"></td>
                                        </tr>
                                        <tr>
                                            <td>Timer 0</td>
                                            <td id="interrupt_timer0"></td>
                                            <td>DMA 3</td>
                                            <td id="interrupt_dma3"></td>
                                        </tr>
                                        <tr>
                                            <td>Timer 1</td>
                                            <td id="interrupt_timer1"></td>
                                            <td>Keypad</td>
                                            <td id="interrupt_keypad"></td>
                                        </tr>
                                        <tr>
                                            <td>Timer 2</td>
                                            <td id="interrupt_timer2"></td>
                                            <td>Game Pak</td>
                                            <td id="interrupt_gamePak"></td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <div id="cpu_info_warning" class="hidden">Not updated while emulator is running</div>
                    </div>
                    <div id="tab2_container" class="hidden">
                        <div id="ppu_info_container" class="hidden">
                            <div class="outline_container">
                                <div style="margin-bottom: 10px;">Display Control Register</div>
                                <table style="width: 100%;">
                                    <tr>
                                        <td>Display mode</td>
                                        <td id="display_mode_text" style="padding-right: 35px;">0</td>
                                        <td>Frame select</td>
                                        <td id="frame_select_text" style="padding-right: 35px;">0</td>
                                        <td>HBlank interval free</td>
                                        <td id="hblank_interval_text">0</td>
                                    </tr>
                                    <tr>
                                        <td>OBJ VRAM Mapping</td>
                                        <td id="obj_vram_mapping_text">2D</td>
                                        <td>Forced blank</td>
                                        <td id="forced_blank_text">1</td>
                                        <td>Enabled backgrounds</td>
                                        <td id="enabled_backgrounds_text">1234</td>
                                    </tr>
                                    <tr>
                                        <td>Display OBJ</td>
                                        <td id="display_obj_text">On</td>
                                    </tr>
                                </table>
                            </div>
                            <div class="outline_container" style="height: 390px;">
                                <div style="margin-bottom: 10px;">Tiles</div>
                                <div style="display: flex; margin-bottom: 10px; justify-content: center;">
                                    <div style="margin-right: 5px;">Charblock</div>
                                    <div class="number_selector" style="margin-right: 10px;"><div id="charblock_decrease">-</div><div id="charblock_value">1</div><div id="charblock_increase">+</div></div>
                                    <div style="margin-right: 5px;">Palette mode</div>
                                    <div style="margin-right: 10px;">
                                        <select class="dropdown" id="palette_mode_dropdown">
                                            <option value="16">16/16</option>
                                            <option value="256">256/1</option>
                                        </select>
                                    </div>
                                    <div style="margin-right: 5px;">Palette index</div>
                                    <div class="number_selector"><div id="palette_index_decrease">-</div><div id="palette_index_value">0</div><div id="palette_index_increase">+</div></div>
                                </div>
                                <canvas id="charblock_canvas" width="406" height="270"></canvas>
                                <div style="text-align: center;">
                                    <div class="page_selector" style="margin: auto; margin-bottom: 10px; margin-top: 10px;">
                                        <div id="tile_page_decrease">&lt;</div>
                                        <div id="tile_page_increase">&gt;</div>
                                    </div>
                                    <div id="tile_range_text">Tiles 0 - 23</div>
                                </div>
                            </div>
                            <div class="outline_container">
                                <div style="margin-bottom: 10px;">Color palettes</div>
                                <div style="margin-bottom: 10px;">
                                    <select class="dropdown" id="palette_dropdown">
                                        <option value="background">Background</option>
                                        <option value="object">Object</option>
                                    </select>
                                </div>
                                <canvas id="palette_canvas" width="380px" height="220px" style="margin-bottom: 10px;"></canvas>
                            </div>
                        </div>
                        <div id="ppu_info_warning" class="hidden">Not updated with emulator is running</div>
                    </div>
                </div>
            </div>
        </div>
    </body>
</html>
